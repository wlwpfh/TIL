### 라우팅 정책 - 지연 시간 기반

지연 시간이 가장 짧은 ⇒ 가장 가까운 리소스로 리다이렉팅을 하는 정책이다.

→ 지연 시간에 민감한 웹사이트나 애플리케이션이 있는 경우 좋다

**지연 시간은 유저가 레코드로 가장 가까운 식별된 AWS 리전에 연결하기까지 걸리는 시간을 기반으로 측정된다.**

상태확인이 가능하다.

### Route 53 - 상태 확인

상태 확인은 주로 공용 리소스에 대해서 상태를 확인하는 방법이다.

⇒ DNS의 장애 조치를 자동화하기 위한 작업이다.

1. 공용 엔드 포인트를 모니터링 하는 것
2. 다른 상태 확인을 모니터링하는 상태 확인 = 계산된 상태 확인
3. cloudwatch 경보의 상태를 모니터링하는 상태 확인

→ 제어가 쉽고 개인 리소스에 유용하다.

**결론적으로 이 상태 확인들은 각자의 메트릭을 사용하는데 CloudWatch의 지표에서도 확인이 가능하다.**

### Health Check - 특정 엔드포인트 모니터링

1. 어느 한 지역의 ALB를 상태확인 한다면 AWS의 상태확인이 전 세계로부터 온다. (15개의 요청)
2. 그 상태확인은 우리가 루트를 설정한 공용 엔드 포인트로 모두 요청을 보낸다. (ex) /health라는 엔드포인트로)
3. 200 OK 또는 우리가 정의한 코드를 받으면 리소스는 정상으로 간주한다.
   +) 받는 간극 시간 설정도 가능하다

HTTP, HTTPS, TCP 등 많은 프로토콜을 지원한다.

18% 이상의 상태 확인이 엔드 포인트를 정상이라고 판단하면 route53도 정상이라고 간주한다.

상태 확인 때 사용할 위치도 선택할 수 있다.

상태 확인은 로드 밸런서로부터 2xx, 3xx의 코드를 받아야만 통과된다.

+) 만약 텍스트 기반 응답일 경우, 상태 확인은 응답의 처음 5120 바이트를 확인한다.

→ 응답 자체에 해당 텍스트가 있는 지 보기 위해서

상태 확인의 작동이 가능하려면 상태확인이 애플리케이션 밸런서나 엔드포인트에 접근이 가능해야 한다.

⇒ IP 주소 범위에서 들어오는 모든 요청을 허용해야 한다.

### Health Check - Calculated Health Check

= 계산된 상태 확인

여러 개의 상태 확인 결과를 하나로 합쳐주는 기능이다.

상태 확인을 계층화하여 하위 상태 확인을 바탕으로 상위 상태 확인을 정의할 수 있다.

상태 확인들을 합치기 위한 조건으로는 **OR, AND, NOT**이 있다.

하위 상태 확인을 256개까지 모니터링할 수 있다.

상위 상태 확인이 통과하기 위해서는 몇 개의 상태 확인을 통과해야 할지도 지정할 수 있다.

### Health Check - Private Hosted Zones

개인 리소스의 상태 확인

모든 route 53의 상태 확인이 vpc 외부에 있다.

→ 개인 엔드 포인트에 접근이 불가능하다.

→ 개인 VPC나 온프레미스의 경우

⇒ 그렇기에 cloudwatch 지표를 만들어 알람을 할당하는 식으로 문제를 해결할 수 있다.

경보를 상태 확인에 할당할 수 있다.

cloudwatch 메트릭을 통해 개인 서브넷 안에 있는 인스턴스를 모니터하는 것이다.

### 라우팅 정책 - 장애 조치

기본 인스턴스, 보조 인스턴스(장애 조치용)이 있다.

기본 인스턴스가 정상이면 route 53도 기본 레코드로 응답한다.

상태 확인이 비정상이면 장애 조치에 도움이 되는 두번째 레코드의 응답을 자동으로 얻게 된다.

### 라우팅 정책 - 지리적 위치

사용자의 실제 위치를 기반으로 한다.

주 / 대륙 / 나라에 지정하는 것이며 가장 정확한 위치가 선택되어 그 IP로 라우팅되는 것이다.

일치하는 위치가 없는 경우에는 기본 레코드를 생성해야 한다.

사용 사례 - 콘텐츠 분산을 제한, 로드 밸런싱 등을 실행하는 웹사이트 현지화가 있다.

+) 이런 레코드는 상태 확인과 연결할 수 있다.

### 라우팅 정책 - 지리적 접근성

사용자와 리소스의 지리적 위치를 기반으로 트래픽을 리소스로 라우팅하도록 한다.

한 리전에서 다른 리전으로 트래픽을 보낼 때 유용하다.

이 정책으로 편향값(bias)을 사용해 특정 위치를 기반으로 리소스로 더 많은 트래픽을 이동하는 것이다.

→ 지리적 위치를 변경하려면 편향값을 지정해야 한다.

+) 특정 리소스에 더 많은 트래픽을 보내려면 편향값을 증가시켜 확장하면 된다.

++) 특정 리소스에 트래픽을 줄이려면 편향값을 음수로 축소시키면 된다.

+) 여기서 리소스

AWS의 리소스 ⇒ 속한 특정 리전을 지정하면 목록에서 자동으로 올바른 라우팅을 계산하거나

AWS 리소스가 아닌 온프레미스 데이터센터 ⇒ 위도와 경도를 지정해서 AWS가 위치를 파악하도록 해야 한다.

### 라우팅 정책 - IP 기반 라우팅

클라이언트 IP 주소를 기반으로 라우팅을 정의한다.

Route 53에서 CIDR 목록( =클라이언트 IP 범위)을 정의한다.

그리고 CIDR에 따라 트래픽을 어느 로케이션으로 보내야 하는지 정한다.

→ IP를 미리 알고 있기에 성능을 최적화할 수 있다.

→ IP가 어디서 오는지 알아서 네트워크 비용을 절감할 수 있다.

### 라우팅 정책 - 다중 값

트래픽을 다중 리소스로 라우팅할 때 사용한다,

route 53은 다중값과 리소스를 반환한다.

상태 확인과 연결하면 다중값 정책에서 반환되는 유일한 리소스는 정상(healthy) 상태 확인과 관련이 있다.

각각 다중 값 쿼리에 최대 8개의 정상 레코드가 반환된다.

ELB와 비슷해보이지만 ELB를 대체할 수 없다.

다중 값이 있는 단순한 라우팅의 경우 → 단순 라우팅 정책은 상태 확인을 허용하지 않기 때문에 단순 라우팅 정책의 쿼리가 반환하는 리소스 중 하나는 비정상일 가능성이 있다.

### Domain Registar vs DNS Service

domain registar를 통해 원하는 도메인 이름을 구매할 수 있다.

registar를 통해 도메인을 등록하면 DNS 레코드 관리를 위한 DNS 서비스를 제공한다.