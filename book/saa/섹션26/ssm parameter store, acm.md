### SSM parameter store

구성 및 암호를 위한 보안 스토리지이다.

구성을 암호화할 지 선택할 수 있다. → KMS 서비스를 이용해 암호를 만들 수 있다.

서버리스이며 확장성과 내구성이 있다.

매개변수를 업데이트할 때 구성과 암호의 버전을 추적할 수 있다.

IAM을 통해 보안이 제공된다.

특정한 경우 amazon eventbridge로 알림을 받을 수 있다.

cloudformation과 통합할 수 있다.

### 계층 구조가 있는 SSM parameter store

원하는 방식으로 매개변수를 구조화할 수 있다.

구조화를 통해 IAM 정책을 간소화하여 애플리케이션이 각 경로에만 접근할 수 있도록 해준다.

또한 화면에 보이는 래퍼런스를 사용해 parameter store로 secrets manager의 암호에 접근할 수 있다.

aws에서 발행하는 퍼블릭 매개변수도 사용할 수 있다.

**고급 매개변수에서만 사용할 수 있는 매개변수 정책이란?**

매개변수 정책을 통해 만료 기간을 뜻하는 TTL를 매개변수에 할당할 수 있다.

→ 사용자가 민감 정보를 업데이트/삭제하도록 강제한다.

한번에 여러 정책을 할당할 수 있다.

### aws secrets manager

암호를 저장하는 최신 서비스이다.

X일마다 강제로 암호를 교체하는 기능이 있어 암호 관리를 더 효율적으로 할 수 있다.

⇒ 교체할 암호를 강제 생성 및 자동화할 수 있다 → lambda 사용

amazon RDS, mySQL, postgreSQL, aurora 등과 잘 통합된다.

→ 여기에 접근하기 위한 id, pw가 secrets manager에 바로 저장되고 교체 등 가능하다.

암호는 KMS 서비스를 통해 암호화된다.

### aws secrets manager - 다중 리전 암호

복수의 aws 리전에 암호를 복제할 수 있고 기본 암호와 동기화된 읽기 전용 복제본을 유지한다

→ 한 리전에 문제가 발생하면 암호 복제본을 독립 실행형 암호로 승격시킬 수 있다.

→ 복제가 되니 다중 리전 앱을 구축하고 재해 복구 전략을 세울 수 있다.

## aws certificate manager(ACM)

TLS 인증서를 aws에서 프로비저닝, 관리 및 배포하게 해준다.

→ 이 인증서는 웹사이트에서 전송 중 암호화를 제공하는 데 쓰인다.

퍼블릭과 프라이빗 TLS 인증서를 모두 지원하며 퍼블릭 TLS 인증서를 사용할 땐 무료로 이용할 수 있다.

인증서를 자동으로 갱신하는 기능이 있다.

여러 aws 서비스와 통합되어 있다.

→ ELB에 TLS 인증서를 불러올 수 있다.

→ cloudfront 배포

→ api gateway의 모든 api에서 불러올 수 있다.

**하지만 EC2 인스턴스에서 사용 불가하다 !!!**

### ACM - 퍼블릭 인증서가 요청되는 과정

1. 인증서에 포함할 도메인 이름을 나열한다.

   전체 주소 도메인 이름도 될 수 있고 와일드카드 도메인도 가능하다.

2. 유효성 검증 방법 : DNS 검증 / 이메일 검증 이 있다.

   DNS 검증: 자동화를 목적으로 SSL 인증서를 자동 갱신하고 싶다면

   ⇒ 이 검증을 사용한다면 DNS 구성에서 CNAME 레코드를 생성해 도메인 소유권을 증명해야 한다.

   route 53이 있다면 ACM과 자동으로 통합해 작업을 수행한다.

   이메일 검증: ACM이 도메인에 등록된 연락처로 이메일을 보내 해당 인증서를 요청했는지 여부를 확인한다.

3. 유효성 검증이 완료되면 인증서가 발행된다.
4. 퍼블릭 인증서도 자동 갱신 목록에 추가된다.

⇒ ACM에서 스스로 생성된 모든 인증서를 만료 60일 전에 자동으로 갱신해줘서 편하다

### ACM - 퍼블릭 인증서 가져오는 방법

ACM 외부에서 생성된 인증서를 ACM으로 가져오는 옵션도 제공한다.

→ 이 경우 ACM 외부에서 생성되었기 때문에 자동 갱신은 불가능하다.

→ 인증서가 만료되기 전에 직접 새 인증서를 가져와야 한다.

인증서가 언제 만료되는지 어떻게 알지?

만료 45일 전부터 매일 만료 이벤트를 eventbridge서비스로 보내준다.

aws config를 이용하는 방법도 있다.

⇒ acm-certificate-expiration-check라는 관리형 규칙이 있다.

만료된 인증서를 확인하는 규칙으로 일수를 조절할 수 있다.

규정 비준수가 있다면 이벤트가 실행되어 eventbridge로 전송된다.

### ACM - alb와 통합

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/0e50c9f9-d6b9-4369-b0d8-a40d14ac1451/b931699f-7a2c-47cc-a498-9cb7ff4673b7/Untitled.png)

ALB에서는 HTTP → HTTPS로 리디렉션 규칙을 설정할 수 있다.

→ 사용자가 HTTP 프로토콜에서 애플리케이션 로드 밸런서에 접근할 때

### ACM + api gateway 통합

- API gateway의 endpoint types
1. 엣지 최적화:
    1. 글로벌 클라이언트를 위한 유형
    2. 먼저 Cloudfront 엣지 로케이션으로 요청을 라우팅하여  지연을 줄이는 방법
    3. 하나의 리전에만 있는 api gateway로 보내지는 경우
2. 리전 엔드 포인트:
    1. 클라이언트가 api gateway와 같은 리전에 있을 때 쓰인다.
    2. 자체 cloudfront 배포를 생성하여 캐싱 및 배포 전략을 제어할 수 있다.
3. 프라이빗 엔드 포인트
    1. 인터페이스 vpc 엔드포인트 (ENI)를 통해 vpc 내부에만 액세스할 수 있다.
    2. 프라이빗 모드에서는 api gateway에 대한 접근을 정의하는 리소스 정책이 필요하다.


ACM 은 엣지 최적화 및 리전 엔드포인트에 적합하다.

- ACM + api gateway 통합
1. api gateway에 사용자 지정 도메인 이름이라는 리소스 생성

2-a. 엣지 최적화 엔드포인트는 요청이 cloudfront에서 라우팅되고

1. TLS 인증서가 cloudfront 배포에 연결된다.

→ TLS 인증서가 반드시 cloudfront와 같은 리전에 생성되어야 한다.

1. route53에 CNAME이나 별칭 레코드를 설정하면 된다.

2-b. 리전 엔드포인트는 API gateway와 리전이 같은 클라이언트를 위한 엔드포인트이다.

1. TLS 인증서를 api gateway에 가져올 때 같은 리전에 속해야 한다.
2. route53에 CNAME이나 별칭 레코드를 설정하면 된다.