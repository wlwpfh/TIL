## ECR

= Elastic Container Registry

→ aws에 도커 이미지를 저장하고 관리하는 데 사용된다.

- 옵션: private / public repository

amazon ECS와 완전히 통합되어 있다.

이미지는 백그라운드에서 S3에 저장된다.

iam 역할을 설정하면 역할이 ECR에 있는 도커 이미지를 인스턴스로 끌어온다.

EC2 인스턴스에 이미지를 끌어온 후에는 컨테이너가 시작된다.

지원: 이미지의 취약점 스캐닝, 버저닝 태그 및 수명 주기 확인 등..

---

## EKS

= Elastic Kubernetes Service

→ aws에 관리형 쿠버네티스 클러스터를 실행할 수 있는 서비스이다.

+) 쿠버네티스란?

: 오픈 소스 시스템으로 도커로 컨테이너화한 애플리케이션의 자동 배포, 확장, 관리를 지원한다.

: **클라우드 애그노스틱(cloud-agnostic) → 모든 클라우드에서 지원된다.**

→ 클라우드/컨테이너 간 마이그레이션을 실행하는 경우 EKS가 좋음!

: 컨테이너를 실행한다는 목적은 ECS와 비슷하지만 사용하는 api가 다르다.

→ ECS는 오픈소스x,

- EKS의 실행 모드
1. EC2 시작 모드: EC2 인스턴스에서처럼 작업자 모드를 배포할 때 사용
2. fargate 모드: EKS 클러스터에 서버리스 컨테이너를 배포할 때 사용

- 사용 사례

  : 회사가 온프레미스나 클라우드에서 쿠버네티스나 쿠버네티스 api를 사용 중일 때 쿠버네티스 클러스터를 관리하기 위해 EKS 사용한다.

### EKS diagram

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/0e50c9f9-d6b9-4369-b0d8-a40d14ac1451/8593980e-4325-472a-b8c3-3f61d7d17d52/Untitled.png)

EKS 작업자 노드를 생성하면 EC2 인스턴스가 구성된다.

각 노드는 EKS 포드를 실행한다.

(여기서 포드란 ECS 태스크와 유사하다.)

EKS 포드가 실행되는 EKS 노드는 오토 스케일링 그룹으로 관리할 수 있다.

EKS 서비스나 쿠버네티스 서비스를 노출할 때에는 private ELB나 public ELB를 설정해서 웹에 연결해야 한다.

### EKS - 노드 유형

1. 관리형 노드 그룹

aws로 노드, 즉 EC2 인스턴스를 생성하고 관리한다.

노드는 EKS 서비스로 관리되는 오토 스케일링 그룹의 일부이다.

온디맨드 인스턴스와 스팟 인스턴스를 지원한다.

1. 자체 관리형 노드

사용자 지정 사항이 많고 제어 대상이 많은 경우에 해당한다.

사용자가 직접 노드를 생성하고 EKS 클러스터에 등록한 다음에 오토스케일링 그룹의 일부로 관리해야 한다.

사전 빌드돤 AMI인 EKS 최적화 AMI를 사용하면 시간을 절약할 수 있다.

온디맨드 인스턴스와 스팟 인스턴스를 지원한다.

1. fargate

노드를 원하지 않는 경우에 해당한다.

유지 관리/ 노드 관리하지 않아도 된다.

EKS에서 컨테이너만 실행하면 된다.

### EKS - 데이터 볼륨 연결하기

1. EKS 클러스터에 스토리지 클래스 매니페스트를 지정해야 한다.
2. 컨테이너 스토리지 인터페이스(CSI)라는 규격 드라이버를 활용한다.
3. 지원 대상: EBS, fargate 모드가 작동하는 EFS, FSx for Lustre, FSx for NetApp ONTAP

---

## AWS App Runner

→ 완전 관리형 서비스로 규모에 따라 웹 애플리케이션과 API 배포를 돕는다.

→ 이 서비스로 누구나 aws에 배포할 수 있다.

먼저 소스코드나 도커 컨테이너 이미지를 가지고 원하는 구성을 설정한다.

= 웹 애플리케이션이나 api에 들어갈 기본 설정을 해야 한다.

app runner 서비스가 자동으로 웹 앱을 빌드하고 배포한다.

api나 웹 앱이 배포된 다음엔 url을 통해 바로 액세스할 수 있다.

- 장점: 오토 스케일링 가능, 가용성이 높다, 로드밸런싱 및 암호화 기능 제공

vpc에 연결할 수 있다.

⇒ 데이터베이스와 캐시, 메시지 대기열 서비스에 연결할 수 있다.

---

### 퀴즈

- EFS 볼륨은 서로 다른 EC2 인스턴스와 서로 다른 ECS 태스크 간의 공유가 가능하다.

  컨테니어의 영구적인 다중 AZ 공유 스토리지로 사용될 수 있다.