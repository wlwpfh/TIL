### CORS

= 교차 오리진 리소스 공유

+) origin = scheme(프로토콜) + host(도메인) + port

CORS는 웹 기반 보안 매커니즘으로 메인 오리진을 방문하는 동안에 다른 오리진에 대한 요청을 허용하거나 거부한다.

같은 오리진 = http://example.com/app1 과 http://example.com/app2

다른 오리진 = http://www.example.com / http://other.example.com

웹 브라우저가 한 웹사이트를 방문하는 동안 요청 체계의 일부로 다른 웹사이트에 요청을 보내야 할 때, 다른 오리진이 CORS헤더를 사용해서 요청을 허용하지 않는 한 해당 요청은 이행되지 않는다.

→ 예를 들어 Access-Control-Allow-Origin 헤더라고 한다.

- **동작 방식**

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/0e50c9f9-d6b9-4369-b0d8-a40d14ac1451/8ad901e5-283d-4f28-91ae-a14cf430b298/Untitled.png)

### Amazon S3 - CORS

클라이언트가 S3 버킷에서 CORS를 요청하면 정확한 CORS 헤더를 활성화해야 한다.

작업을 빠르게 수행하려면 특정 오리진을 허용하거나 *를 붙여 모든 오리진을 허용한다.

---

### amazon S3- MFA Delete

MFA - 사용자가 장치에서 코드를 생성하도록 강제한다.

MFA가 필요할 때

→ 객체 버전을 영구적으로 삭제할 때

→ 버킷에서 버저닝을 중단할 때

MFA delete를 사용하려면 먼저 버킷에서 버저닝을 활성화해야 한다.

버킷 소유자 (= 루트 계정)만 MFA Delete를 활성화하거나 비활성화할 수 있다.

---

### S3 Access log

감사의 목적으로 S3 버킷에 대한 모든 액세스를 기록할 수 있다.

어떤 계정에서든 S3로 보낸 모든 요청은 승인 또는 거부 여부와 상관없이 다른 S3 버킷에 파일로 기록된다.

→ 해당 데이터는 amazon athena와 같은 데이터 분석 도구로 분석할 수 있다.

대상 로깅 버킷은 같은 AWS 리전에 있어야 한다.

- **주의 사항**

로깅 버킷을 모니터링하는 버킷과 동일하게 설정하지 말아라.

→ 동일하게 설정하면 로깅 루프가 생성되고 무한 생성으로 크기가 매우 커진다.

---

### S3 presigned URLs

S3 콘솔, CLI, SDK를 사용하여 생성할 수 있는 URL이다.

URL은 만료 기한이 있다.

→ S3 콘솔을 사용하면 최대 12시간

→ CLi → 168 시간

url을 생성할 때 url을 받는 사용자는 url을 생성한 사용자의 get/ put에 대한 권한을 상속한다.

---

### S3 Glacier Vault Lock 볼트 잠금

WORM 모델을 채용하기 위해 Glacier 볼트를 잠그는 것이다.

WORM (= write once read many)

객체를 가져와서 glacier vault에 넣은 다음에 수정하거나 삭제할 수 없도록 잠그는 것이다.

glacier 위에 볼트 잠금 정책을 생성한 다음 향후 편집을 위해 정책을 잠급니다.

→ 볼트 잠금 정책을 설정하고 잠근 후에는 누구나 변경하거나 삭제할 수없게 된다.

규정 준수와 데이터 보존에 아주 효율적이다.

### S3 Object Lock (versioning must be enabled)

S3 객체 잠금을 활성화하려면 먼저 버저닝을 활성화해야한다.

여기서도 WORM 모델을 채택할 수 있다.

객체 잠금은 전체 버킷 수준이 아니라 버킷 내 모든 객체에 각각 적용할 수 있는 잠금이다.

단일 객체를 객체 잠금할 수 있다.

S3 객체 잠금을 사용하면 특정 객체 버전이 특정 시간동안 삭제되는 것을 차단할 수 있다.

- 보존 모드
1. 규정 준수 모드

S3 glacier vault 잠금과 매우 유사하다.

사용자를 포함한 그 누구도 객체 버전을 덮어쓰거나 삭제할 수 없다.

규정 준수 모드에서는 누구도 객체를 변경 불가하다.

보존 모드 자체도 변경 불가능하고 보존 기간도 단축할 수 없다.

1. governace 보존 모드 - 조금 더 유연성

대부분의 사용자는 객체 버전을 덮어쓰거나 삭제하거나 로그 설정을 변경할 수 없다.

근데 몇몇 유저는 iam을 통해 부여받은 권한으로 보존 기간을 변경하거나 객체를 삭제할 수 ㅇㅆ다.

두 모드 다 보존 기간을 설정해야 한다.

그 기간동안 객체를 보호할 수 있고 원하는 기간만큼 기간 연장할 수 있다.

객체를 잠그는 것 중 하나는 객체에 **법적 보존 상태를 설정**하는 것이다.

→ s3 버킷 내 모든 객체를 무기한으로 보호한다.

진짜 중요한 객체에 사용한다.

s3:PutObjectLegalHold iam 권한을 가진 사용자는 어떤 객체든 법적 보존 을 설정하거나 삭제할 수 있다.

---

### S3 - Access Points

access point에 정책을 정의해서 데이터와 연결되어 읽기/쓰기 액세스 권한을 부여한다.

보안 관리를 S3 버킷 정책에서 꺼내어 access point에 넣었다.

모든 access point는 각자 보안을 갖고 있는다.

→ access point는 버킷의 보안 관리를 간소화해준다.

→ 각각의 access point는 각자의 dns 이름을 갖게 된다.

- S3- access point - vpc origin

s3 access point의 vpc origin을 우리는 private acess가 가능하도록 정의할 수 있다.

→ vpc 엔드포인트라는 것을 만들어야 한다.

→ 이것은 vpc 안에 있고 우리가 vpc 오리진을 통해 액세스 포인트에 사적으로 접속할 수 있게 해준다.

---

### S3 Object Lambda

s3 액세스 포인트의 또 다른 활용 사례이다.

s3 lamda를 위해서는 s3 access point가 필요하다.