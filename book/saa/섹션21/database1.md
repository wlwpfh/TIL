## Databases

aws에는 여러 관리형 데이터베이스가 있다.

아키텍처에 맞는 데이터베이스를 고르는 것이 중요하다.

→ 쓰기가 많은지, 읽기가 많은지. 처리량이 얼만지, 얼마나 달라지는지, 데이터는 얼마나 저장되는지..

### database types

1. RDBMS - SQL을 사용하거나 온라인 트랜잭션을 처리할 때 사용한다. join에 유용하다.

→ rds, aurora

1. NoSQL - 유연한 데이터베이스이지만 조인 기능이 없고 보통 sql 쿼리 언어를 사용하지 않는다.

→ dynamoDB, elastiCache, neptune, documentDB, keyspaces

1. object store

→ s3(대용량 객체 저장용), glacier(백업, 아카이브용)

1. data warehouse - SQL 분석이나 비즈니스 인텔리전스를 사용

→ redshift, athena, emr

1. search

→ opensearch (자유롭게 텍스트 입력, 비정형 데이터 검색 가능)

1. 그래프 - 데이터 세트 간의 관계 표시

→ amazon neptune

1. ledger(원장) 데이터베이스 : 트랜잭션 목록과 원장을 기록할 수 있다.

→ amazon quantum ledger database

1. 시계열 데이터베이스

→ amazon timestream

---

### RDS

- 관리형 postgreSQL, mySQL, Oracle, SQL 서버,  mariaDB, 사용자 지정 RDS가 있다.
- RDS를 사용할 때 RDS 인스턴스 크기와 EBS 볼륨 유형 및 크기를 프로비저닝해야 한다.
- 스토리지 계층에 오토 스케일링 기능이 있어도 프로비저닝해야 한다.
- 읽기 용량 확장을 위해 읽기 전용 복제본을 지원한다.
- 고가용성 목적으로 대기 데이터베이스를 다중 AZ에 둘 수 있다.

+) 대기 데이터베이스: 재해 발생 대비용, 쿼리 수행 불가

- RDS 데이터베이스 보안은 IAM을 통해 설정 가능
- 네트워크 보안을 위해 RDS db에 보안 그룹 설정 가능
- 저장 데이터 암호화에는 KMS
- 전송데이터 암호화 SSL/TLS 가능
- 자동 백업 옵션 - 최대 35일 지원 + 35일 내 지원 기능: 지정 시간 복구 기능 지원 → 복구 시 새 데이터베이스 생성
- 장기 보존 백업이 필요한 경우 수동 db 스냅샷 사용
- 유지 관리 기능을 예약할 수 있어 데이터베이스 다운타임이 발생할 수 있다.

→ 프로비저닝하거나 aws가 데이터베이스 엔진을 주기적으로 업데이트하고 기본 ec2 인스턴스에 보안 패치를 실행할 때 발생 가능

- RDS 프록시를 강제하여 RDS에 IAM 인증을 추가하는 기능이 있다.
- secrets manager와 통합하여 db 자격 증명을 관리할 수 있다.
- 기본 인스턴스에 액세스하고 사용자 지정하려면 RDS 사용자 지정 옵션을 사용할 수 있다.

→ oracle, sql 서버 유형의 데이터베이스에서 지원

⇒ 관계형 데이터베이스를 저장하는데 사용된다.

ex) rdbms와 온라인 트랜잭션 처리 데이터베이스(oltp), sql 쿼리 실행, 트랜잭션 등..

### aurora

- 두 개의 데이터베이스 엔진과 호환 가능한 api

→ postgresql, mysql

- 스토리지와 컴퓨팅이 구분되어 있다.
- 스토리지

→ 스토리지는 기본 설정으로 세 개의 가용영역에 걸친 여섯개의 래플리카에 데이터를 저장하며 이것은 변경될 수 없다.

→ 매우 가용적

→ 스토리지에 문제가 생겼을 경우 자가 복구 과정이 일어난다.

→ 오토 스케일링 o

- 컵퓨팅

→ 실제 데이터베이스 인스턴스들이다. 원한다면 여러 개의 가용영역에 걸쳐/모여있기 가능하다.

→ 읽기 전용 복제본도 auto scaling 가능하다.

- 클러스터: 어디서 읽기/쓰기가 되는지 알기 위해 사용자 정의된 엔드포인트가 필요하다.

→ writer endpoint, reader endpoint

- rds와 동일한 보안 모닌터링 및 유지 기능이 있다. → 둘이 같은 엔진 사용
- 백업과 복구 옵션들을 알아야 함.
- 기능
    1. aurora serverless: 에측 불가능한, 간헐적인 워크로드가 있을 때 + 용량 계획x
    2. aurora global: 글로벌 데이터베이스를 원할 때 → 16개의 데이터베이스 리드 인스턴스를 제공 + 스토리지 복제는 1초 미만 시간에 일어나며 주로 리전 사이에서 일어난다.
    3. aurora machine learning: sagemaker, comprehend를 사용해서
    4. aurora database cloning: 테스트 데이터베이스나 스테이징 데이터베이스를 사용하고 싶을 때, 복제 기능 사용 가능 → 기존에 존재하던 것의 밖에 새로운 aurora 클러스터를 만들기 위해

  +) 스냅샷을 하고 복구보다 더 빠르다.


⇒ RDS와 비슷하지만 보수는 적고 유연성은 더 높으며 성능이 더 높고 더 다양한 기능이 있다.

### ElastiCache

- 관리형 redis/memcached로 rds와 비슷하지만 캐싱 작업에 활용된다.
- 인 메모리 데이터 스토어로 1밀리초 미만의 지연시간을 제공한다.
- 캐시를 위한 ec2 인스턴스 유형을 프로비저닝해야 계속 진행할 수 있다.
- redis용에서는 클러스터 생성, 다중 az, 샤딩을 위한 읽기 전용 복제본을 사용할 수 있다.
- IAM을 통해 프로비저닝한 보안과 보안그룹을 사용할 수 있다.
- 저장 데이터 암호화를 위한 KMS, redis 인증 사용 가능
- rds처럼 백업, 스냅샷, 지정 시간 복구 같은 기능 사용 가능
- 관리형 및 예약된 유지 관리 가능
- **ElastiCache를 사용해 RDS가 결합된 데이터베이스에서 캐싱 작업을 수행하려면 애플리케이션 코드가 ElastiCache를 활용하도록 코드를 수정해줘야 한다.**

⇒ key-value store, 데이터베이스 자주 읽기 → database query를 캐싱, 웝사이트 사용자를 위해 세션 데이터 저장, SQL 사용 불가