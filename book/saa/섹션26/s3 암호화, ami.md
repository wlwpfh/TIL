### S3 암호화된 복제

한 버킷에서 다른 버킷으로 S3 복제를 활성화하면 암호화되지 않은 객체와 SSE-S3로 암호화된 객체가 기본으로 복제된다.

고객 제공 키인 SSE-C로 암호화된 객체도 복제될 수 있다.

SSE-KMS로 암호화된 객체도 있다.

→ 객체를 복제하려면 옵션을 활성화해야 한다.

→ 어떤 kms 키로 대상 버킷 내 객체를 암호화하는지 지정해야 한다.

→ 이 kms 키 정책을 대상 키에 적용해야 하고 s3 복제 서비스를 허용하는 iam 역할을 생성해서 소스 버킷의 데이터를 먼저 복호화하도록 한 뒤 대상 kms 키로 대상 버킷의 데이터를 다시 암호화한다.

⇒ 이렇게 하면 복제가 활성화되는데 이는 수많은 암호화와 복호화가 발생하기 때문이다.

+) kms 스로틀링 오류가 발생한 경우에는 서비스 할당량을 요청해야 한다.

+) s3 복제에 다중 리전 키를 사용할 수 있으나 현재는 s3 서비스에서 독립 키로 취급하고 있어 객체는 여전히 복호화되고 다중 리전 키인 경우에도 동일한 키로 암호화된다.

### ami를 다른 계정과 공유하는 과정

1. ami는 KMS 키로 암호화되어 있다.

   ami는 소스 계정에 있고 kms 키로 암호화된 것이다.

2. 시작 권한으로 ami 속성을 수정해야 한다.

   이 시작 권한은 b 계정에서 ami를 시작하도록 허용한다.

   ⇒ 시작 권한을 수정하고 특정 대상인 aws 계정 id를 추가하는 것이다.

3. 다음 b 계정에서 사용하도록 kms 키도 공유해야 하므로 일반적으로 키 정책으로 실행된다.
4. b 계정에서 kms 키와 ami를 모두 사용할 수 있는 충분한 권한을 가진 iam 역할/사용자를 생성한다.
5. 모두 완료된 후에는 ami에서 ec2 인스턴스를 시작하면 된다.

+) 선택 사항으로 대상 계정에서 자체 계정의 볼륨을 재암호화하는 kms 키를 이용해 전체를 재암호화할 수 있다.