### CloudFront

content Delivery Network (CDN)

웹사이트의 컨텐츠를 서로 다른 엣지 로케이션에 미리 캐싱하여 읽기 성능을 높인다.

→ 컨텐츠가 네트워크 전체에 캐싱되므로 전세계 사용자들이 낮은 latency로 접근할 수 있다.

→ 사용자 경험을 증대시킨다.

216개의 엣지 로케이션을 통해 구성되어 있다.

콘텐츠가 전체적으로 분산되어 있다.

→ DDoS 공격에서 보호받을 수 있다.

DDoS = 동시에 모든 서버가 공격을 받는 방식

VPC가 없다.

### CloudFront - Origins 원본 제공 방식

1. S3 버킷

cloudFront를 통해 파일을 분산하고 캐싱할 수 있게 한다.

버킷에서는 cloudfront만 접근할 수 있게 보장한다.

⇒ OAC(=Origin Access Control)가 이를 가능하게 한다.

→ 기존의 OAI를 대체한다.

cloundfront를 통해 버킷에 데이터를 보내는 방법도 가능하다. ⇒ ingress라고 한다.

1. custom origin(HTTP) 사용자 정의 원본

application load balancer, EC2 instance, S3 website가 있다.

### CloudFront의 장업 방식

1. 클라이언트가 연결해서 엣지 로케이션에 HTTP 요청을 보낸다.
2. 엣지는 이것이 origin에 캐싱되어 있는지 확인한다.
캐싱되어 있지 않은 경우에는 원본으로 가서 요청 결과를 가져온다.
3. 결과를 가져오면서 이를 로컬 캐시에 저장해서 다른 클라이언트가 같은 컨텐츠를 같은 엣지에 요청할 때 사용한다.

### CloudFront vs S3 Cross Origin Replication (CRR 교차 리전 복제)

- CloudFront

전세계의 엣지 네트워크를 이용한다.

216개의 엣지 로케이션에 하루 동안 파일들이 캐싱된다.

**전세계를 대상으로 한 정적 컨텐츠를 사용할 때 용이하다.**

- S3 CRR

복제를 원하는 각 리전에 이 설정이 되어 있어야 한다. → 전세계 대상X

파일이 거의 실시간으로 갱신된다.

읽기 전용으로만 설정 가능하다.

**일부 리전을 대상으로 동적 컨텐츠를 낮은 지연 시간으로 제공하고자 할 때 용이하다.**

### CloudFront - ALB, EC2 instance

1. EC2 instance

사용자들이 엣지 로케이션에 접근한다.

엣지 로케이션이 인스턴스에 요청을 보낸다.

→ 이러기 위해서는 EC2 인스턴스가 퍼블릭으로 설정되어야 한다.

→ 엣지 로케이션의 모든 공용 ip가 인스턴스에 접근할 수 있도록 하는 보안 그룹을 설정해줘야 한다.

1. ALB (Application Load Balancer)

ALB만 일단 퍼블릭이면 된다. ( 인스턴스는 private이어도 ㄱㅊ)

사용자들이 엣지 로케이션에 접근한다.

엣지 로케이션이 ALB에 요청을 보낸다.

→ 애플리케이션의 public ip가 로드 밸런서의 보안 그룹 정책에 허용되어 있어야 한다.

---

### CloudFront 지리적 제한 기능

사용자들의 지역에 따라 배포 객체 접근을 제한할 수 있다.

→ 접근이 가능한 국가 목록을 만들거나 접근이 불가능한 국가 목록을 만들어서 설정할 수 있다.

(AllowList, BlockList)

이 국가는 서드 파티 지역 DB에서 설정한 것이다.

→ 사용자의 ip가 어떤 국가에 해당하는 지를 확인할 수 있다.

사용사례: 컨텐츠 저작권법으로 인한 제한 기능

---

### CloudFront - 고급 옵션 - 요금과 가격 등급

cloudfront 엣지 로케이션은 전 세계에 고루 분포해있다.

→ 그렇기에 엣지 로케이션마다 데이터 전송 비용이 다르다.

cloudfront에서 더 많은 데이터가 전송될 수록 비용은 낮아진다.

- 비용 절감 방법

cloudfront를 분산할 전 세계 엣지 로케이션 수를 줄이는 방법이 있다.

1. price class all: 모든 리전을 사용 - 최상의 성능을 제공한다. → 비용이 많이 든다.
2. price class 200: 대부분의 리전을 사용할 수 있지만 가장 비싼 리전은 제외된다.
3. price class 100: 가장 저렴한 리전만 사용할 수 있다.

### CloudFront - 캐시 무효화

cloudfront에는 항상 백엔드 오리진이 있다.

cloudfront 엣지 로케이션은 우리가 백엔드 오리진을 업데이트할 때 업데이트 사항을 모를 것이다.

캐시의 TTL이 만료되면 백엔드 오리진으로부터 업데이트된 컨텐츠를 받게 된다.

if 이 상황이 싫다면? 최대한 빨리 반영시키고 싶다면?

전체/일부 캐시를 강제로 새로고침하여 캐시에 있는 TTL을 모두 제거할 수 있다.

→ 이를 위해서는 cloudfront 무효화를 실행해야 한다.

이 때 특정 파일 경로를 전달해야 한다. (ex) /images/*)

---

### AWS Global Accelerator 개요

- 시나리오

→ 글로벌 애플리케이션을 배포함. 글로벌 사용자들이 직접 접근하려 한다.

하지만 애플리케이션은 오직 한 리전에 배치되어 있다.

한 국가에 있는 public ALB로 다양한 국가의 사용자들이 접근한다.

사용자들이 애플리케이션에 접근할 때 공용 인터넷을 통하게 된다.

→ 라우터를 거치는 동안 수많은 홉으로 인해 상당한 지연이 발생할 수 있다.

→ 홉들이 많다는 것은 위험요소로 접근할 때마다 연결이 끊길 수 있다.

⇒ 지연시간을 최소화하기 위해서는 최대한 빨리 Aws 네트워크를 통하느 ㄴ것이 좋다.

→ 이를 위해 global accelerator를 사용한다.

### AWS Global Accelerator

anycast IP 개념을 사용한다.

애플리케이션을 라우팅하기 위해 aws 내부 글로벌 네트워크를 활용한다.

1. 가장 가까운 엣지 로케이션과 통신할 것이다.
2. 내부 aws 네트워크를 거쳐 alb로 곧장 연결된다.

⇒ 요점은 anycast ip를 사용한다는 것이다.

애플리케이션을 위해 2개가 생성되며 둘 다 글로벌하다.

anycast ip는 사용자와 가장 가까운 엣지 로케이션으로 트래픽을 직접 전송한다.

1. 연결 사례

→ 탄력적 ip, EC2 인스턴스, ALB, NLB, public or private 

1. 네트워크를 거치기 때문에 안정적인 성능을 보여준다.

→ 지능형 라우팅으로 지연 시간이 가장 짧은 엣지 로케이션으로 연결되며 신속한 리전 장애 조치가 있다.

→아무것도 캐시하지 않기에 클라이언트 캐시와도 문제가 없다.

→ 사용하는 두 개의 anycast ip는 변하지 않기 때문에 

→ 엣지 로케이션 다음에 내부 aws 네트워크가 오기 때문에 성능적으로 안정적이다.

1. 상태 확인

→ global accelerator이 애플리케이션에 대해 상태 확인을 실행한다.

→ 애플리케이션이 글로벌한지 확인한다.

→ 한 리전에 있는 한 ALB에 대해 상태 확인을 실패하면 자동화된 장애 조치가 1분 안에 정상 엔드 포인트로 실행된다.

→ 상태 확인 덕분에 재해 복구에 특히 뛰어나다.

1. 보안

클라이언트가 화이트리스트 해야 하는 단 두 개의 외부 ip만 존재하기에 안전하다.

global accelerator를 통해 ddos 보호도 자동을호 받게 된다.

---

### Unicast IP vs Anycast IP

- unicast IP - 하나의 서버가 하나의 ip 주소를 가진다.
- anycast IP -  모든 서버가 동일한 ip 주소를 가지며 클라이언트는 가장 가까운 서버로 라우팅된다.

---

### AWS Global Accelerator vs CloudFront

둘 다 동일한 글로벌 네트워크를 사용하고 aws가 생성한 전 세계의 엣지 로케이션을 이용한다.

ddos 보호를 위해 둘 다 aws shield와 통합된다.

- cloudfront

이미지나 비디오처러 캐시 가능한 내용 /  api 가속 및 동적 사이트 전달에 성능을 향상시킨다.

이 내용은 엣지 로케이션으로부터 제공된다.

캐시된 내용을 엣지로부터 가져와서 전달한다.

→ 사용자들은 엣지로부터 내용을 받는 것이다.

- global accelerator

tcp나 udp 상의 다양한 애플리케이션 성능을 향상시킨다.

패킷은 엣지 로케이션으로부터 하나 이상의 aws 리전에서 실행되는 애플리케이션으로 프록시된다.

→ 모든 요청이 애플리케이션쪽으로 전달된다.

캐싱은 불가능하다.

게임/ ioT/ voice over IP 와 같은 비HTTP를 사용할 경우에 적합하다.

글로벌하게 고정 ip를 요구하는 HTTP를 사용할 때에도 매우 유용하다.

결정적이고 신속한 리전 장애 조치가 필요할 때에도 좋다.