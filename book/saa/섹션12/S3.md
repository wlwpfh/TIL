## Amazon S3 소개

**S3**  
= 무한하게 확장할 수 있는 스토리지

### S3 사용 사례

본질적으로 스토리지이기 때문에 사용 사례가 많다.

- 백업과 저장소로 사용된다.
- 재해 복구 용도로 사용된다.

→ 리전이 다운되는 경우 데이터를 다른 리전으로 이동할 때 사용한다.

- 아카이브 용도

→ S3에 파일을 아카이브해 두면 추후 매우 손쉽게 검색할 수 있다.

- 하이브리드 클라우드 스토리지
- 애플리케이션 호스팅
- 동영상 파일 및 이미지 등의 미디어 호스팅
- 데이터 레이크(lakes) & 빅데이터 분석

→ 다량의 데이터 저장

- 소프트웨어 배달
- 정적 웹 사이트 호스팅

### Amazon S3 - buckets

- 파일을 버킷에 저장하며 버킷은 상위 레벨 디렉토리로 표시된다.
- 버킷의 파일은 객체(object)라고 하며 버킷은 계정 안에 생성된다.
- 버킷에는 전역적으로 고유한 이름이 있어야 한다. (=globally unique name across all regions all accounts)

⇒ 이름 계정이 있는 모든 리전과 AWS에 존재하는 모든 계정에서 고유해야 한다.

- 버킷은 리전 수준에서 정의된다.

→ 버킷 이름이 모든 리전과 계정에서 고유해도 버킷은 반드시 특정 리전에서 정의되어야 한다.

- S3는 전역 서비스처럼 뵝지만 버킷은 리전에서 생성된다.
- naming convention

  → 대문자나 밑줄X, 길이 3~63자, IPX, 소문자나 숫자로 시작, 접두사 제한O


### Amazon S3 - Objects

객체(파일)에는 키가 있다.

**여기서 키는 파일의 전체 경로이다.**

키는 접두사 + 객체 이름으로 구성되어 있다.

(접두사는 앞의 폴더 이름, 객체 이름은 온전한 객체의 이름이다)

S3 그 자체로는 디렉토리의 개념은 없다.

**Objects란?**

값은 본문의 내용이다.

무엇이든지 S3에 업로드할 수 있다.

+) 최대 5TB 크기

5GB 이상과 같은 큰 파일을 업로드하는 경우에는 멀티파트 업로드를 사용해서 파일을 여러 부분으로 나눠서 업로드해야 한다.

메타 데이터를 갖고 있다.

→ 객체의 키-값 페어 리스트를 의미한다.

→ 이는 시스템이나 사용자에 의해 설정되어 파일에 관한 요소나 메타데이터를 나타낼 수 있다.

태그

→ 유니코드 키-값 페어는 최대 10개까지 가능하다.

→ 보안과 수명 주기에 유용하다.

버전 ID

→ 버전관리를 활성화 한 경우에 갖는다.

### Amazon S3 - Security

1. 사용자 기반

사용자에게는 IAM 정책이 주어진다. 이 정책은 어떤 API 호출이 특정 IAM 사용자를 위해 허용되어야 하는지를 승인한다.

1. 리소스 기반
- S3 버킷 정책을 사용할 수 있다. 이 정책은 S3 콘솔에서 직접 할당할 수 있는 전체 버킷 규칙이다.

ex) 특정 사용자가 들어올 수 있게 하거나다른 계정 사용자를 허용할 수 있다

→ 버킷에 액세스 할 수 있는 교차 계정이라 한다.

- 객체 액세스 제어 목록 (Object Access Control List (ACL))

세밀한 보안이며 비활성화 할 수 있다.

- 버킷 액세스 제어 목록 (Bucket Access Control List (ACL))

훨씬 덜 일반적이며 비활성화 할 수 있다.

**질문: 어떤 상황에서 IAM 원칙이 S3 객체에 액세스할 수 있을까?**

→ IAM 권한이 이를 허용하거나 리소스 정책이 이를 허용하는 경우

→ 그리고 이것이 작동할 때에는 명백한 거부가 없다.

(IAM 원칙이 특정 API 호출 시 S3 객체에 액세스할 수 있는 것이다.)

1. 암호키를 사용하여 객체를 암호화하는 것

### S3 Bucket Policies

JSON 기반의 정책으로 활용된다.

- 구성요소
1. Resource

정책이 적용되는 버킷과 객체를 정책에 알려준다.

1. Effect

Actions을 허용 / 거부 (allow / deny)

1. Actions

허용하거나 거부할 수 있는 API 집합

1. Principal

원칙은 정책을 적용할 계정/사용자를 제시한다.

필요한 버킷 정책을 사용해서 버킷에 대해 공개 액세스를 허용할 수 있다.

또는 업로드 시 객체를 강제로 암호화하거나 다른 계정으로의 액세스를 허용할 수 있다.

### bucket setting for block public access

해당 설정은 기업 데이터 유출을 방지하기 위한 추가 보안 계층이다.

S3 버킷 정책을 설정하여 공개로 만들더라도 이 설정이 활성화되어 있으면 버킷은 공개되지않는다.

→ 데이터 유출 방지

### Amazon S3 - Static Website Hosting

S3를 이용하여 정적 웹 사이트를 생성하는 방법!

S3는 정적 웹사이트를 호스팅하고 인터넷에서 접근하도록 만들 수 있다.

웹 사이트 URL은 이것을 생성하는 리전에 따라 달라진다.

우리는 현재 S3 버킷을 가지고 있으며 이 버킷에는 html 파일이나 이미지 파일 등이 있다.

해당 파일 경로로 사용자는 S3 **버킷에**  액세스할 수 있게 된다.

### Amazon S3 **- Versioning 버전 관리**

S3에서는 파일을 버전 관리할 수 있다.

→ 버킷 수준에서 활성화해야 하는 설정이다.

ex) 버킷이 주어졌고 버전 관리로 활성화된 상태이다.

사용자가 파일을 업로드할 때마다 선택키에서 해당 파일의 버전이 생성된다.

동일한 키를 업로드하고 해당 파일을 덮어쓰는 경우 버전2, 버전3 등을 생성하게 된다.

⇒ 버킷을 버전관리하는 것이 좋다.

→ 의도하지 않게 삭제하지 않도록 보호해준다.

→ 이전 버전으로 쉽게 롤백할 수 있다.

**유의사항**

버전관리를 활성화하기 전에 버전 관리가 적용되지 않은 모든파일은 null 버전을 갖게 된다.

버전 관리를 중단해도 이전 버전을 삭제하지 않는다.

### Amazon S3 - Replications (CRR & SRR) 복제기능

**CRR - 교차 리전 복제**

**SRR - 같은 리전으로 복제**

특정 리전에 S3 버킷이 있고 이를 다른 리전의 S3 버킷에 복제해야 할 때 사용한다.

+) 버킷간의 비동기 복제가 필요하다고 가정해보자면..?

그러기 위해서는

1. 소스 버킷과 복제 대상 버킷 둘 모두 버전 관리 기능이 활성화되어야 한다.
2. CRR은 이름 그대로 두 리전이 달라야 하며
3. SRR은 같은 리전이어야한다.

버킷은 서로 다른 AWS 계정간에도 사용할 수 있다.

복제는 비동기식으로 이뤄진다.

⇒ 복제 과정은 백그라운드에서 이뤄진다.

복제 기능이 정상적으로 실행되려면 S3에 올바른 IAM 권한(=읽기, 쓰기)를 S3에 부여해야 한다.

- 사용 사례

CRR - 컴플라이언트, 법규나 내부 체제 관리, 데이터가 다른 리전에 있어 발생할 수 있는 지연 시간을 줄일 경우에 사용한다. 계정간 복제에도 사용할 수 있다.

SRR - 다수의 S3 버킷간의 로그를 통합할 때, 개발 환경이 별도로 있어 운영 환경과 개발 환경간의 실시간 복제를 필요로 할 때

+) 복제를 활성화한 후에는 새로운 객체만 복제의 대상이 된다.

만약 기존의 객체를 복제하려면 S3 배치 복제 기능을 사용해야 한다.

→ 기존 객체부터 복제에 실패한 객체까지 복제할 수 있는 기능이다.

++) 만약 작업을 삭제하려면?

→ 소스 버킷에서 대상 버킷으로 삭제 마커를 복제하면 된다.

버전ID로 삭제하는 경우 버전 ID는 복제되지 않는다.

+++) chaining 복제는 불가하다.

### S3 Storage Classes

1. Amazon S3 Standard - 범용적으로 사용된다.
2. Amazon S3 Standard-Infrequent Access(IA)
3. Amazon S3 One Zone-Infrequent Access
4. Amazon S3 Glacier Instant Retrieval
5. Amazon S3 Glacier Flexible Retrieval
6. Amazon S3 Glacier Deep Archive
7. Amazon S3 Intelligent Tiering

+) S3에서 객체를 생성할 때 클래스를 선택할 수 있고 스토리지 클래스를 수동으로 수정할 수 있다.

++) S3 수명 주기 구성을 사용해 스토리지 클래스 간에 객체를 자동으로 이동할 수 있다.

### S3 **Durability and Availability 내구성과 가용성**

내구성 - S3로 인해 객체가 손실되는 횟수를 나타낸다. S3는 매우 뛰어난 내구성을 제공한다.

모든 스토리지 클래스의 내구성은 동일하다.

가용성 - 서비스가 얼마나 용이하게 제공되는지를 나타낸다.

스토리지 클래스에 따라 다르다.

### Amazon S3 Standard

- 99.99%의 가용성이다.
- 자주 접근하는 데이터에 사용된다.
- 지연 시간이 짧고 처리량이 높다.
- 두 개의 기능 장애를 동시에 버틸 수 있다.
- 사용사례: 빅데이터 분석, 모바일 게임 어플리케이션, 콘텐츠 배포

### Amazon S3 Standard-Infrequent Access

자주 접근하지는 않지만 필요한 경우 빠르게 액세스해야 하는 데이터를 말한다.

검색 비용이 발생한다.

- 가용성 99.9%
- 사용사례: 재해 복구, 백업

**+) Amazon S3 One Zone-Infrequent Access**

**단일 AZ 내에서는 높은 내구성을 갖지만 AZ가 파괴된 경우 데이터를 잃게 된다.**

가용성은 99.5%

사용사례: 온프레미스 데이터 2차 백업, 재생성 가능한 데이터 저장

### Amazon S3 Glacier Storage Classes

콜드 스토리지로 아카이빙과 백업을 위한 저비용 객체 스토리지이다.

비용 = 스토리지 비용 + 검색 비용

세 가지 클래스가 있다.

1. Amazon S3 Glacier Instant Retrieval

밀리초 단위로 검색이 가능하다.

분기에 한 번 접근하는 데이터에 적합하다.

최소 보관 기간이 90일

1. Amazon S3 Glacier Flexible Retrieval (formerly Amazon S3 Glacier)

세 가지 옵션이 있다.

expedited - 데이터를 1~5분 사이에 받을 수 있다.

standard - 데이터를 돌려받는 데 3~5시간

bulk - 데이터를 받는데 5~12시간

+) 역시나 최소 보관 기간은 90일이다.

1. Amazon S3 Glacier Deep Archive - 장비 보관용

standard - 12 hour

bulk - 48 시간

+) 최소 보관 기간은 180일

### S3 Intelligent-Tiering

사용 패턴에 따라 액세스된 티어 간에 객체를 이동할 수 있게 해준다.

이거는 검색 비용이 없다.

- frequent access 티어는 자동이고 기본 티어이다.
- infrequent acess 티어는 30일동안 액세스하지 않는 객체 전용 티어이다.
- archive instant access 티어도 자동이지만 90일도안 액세스하지 않은 티어 전용
- archive access tier는 선택 사항이며 90~700일 이상까지 구성 가능
- deep archive access iter는 선택 사항이며 180~700일 이상 액세스 하지 않은 객체 전용

알아서 객체를 이동시켜 주기 때문에 스토리지 관리를 편하게 할 수 있다.